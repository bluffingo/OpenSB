{% extends "_layout.twig" %}

{% set title = data.username %}

{% block scripts %}
    <script>
        comment_type = 'profile';
        comment_id = '{{ data.id }}'
    </script>
{% endblock %}

{% block content %}
    <div>
        <div class="profile-box">
            <div class="profile-box-pfp">
                <img src="{{ profile_picture(data.username) }}" class="pfp" alt="{{ data.username }}">
            </div>
            <div class="profile-box-info">
                <div class="profile-box-username">
                    {{ data.username }}
                </div>
                <div class="profile-box-displayname">
                    {{ data.displayname }}
                </div>
                {% if show_work_in_progress_stuff %}
                <div class="profile-box-links">
                    <a href="user.php?name={{ data.username }}&page=submissions" class="link">
                    <span class="elink">
                        Submissions
                    </span>
                    </a>
                    <a href="user.php?name={{ data.username }}&page=submissions" class="link">
                    <span class="elink">
                        Scraps
                    </span>
                    </a>
                    <a href="user.php?name={{ data.username }}&page=submissions" class="link">
                    <span class="elink">
                        Journals
                    </span>
                    </a>
                </div>
            </div>
            {% endif %}
        </div>
    </div>
    <div class="content-header profile-stats">
        <span class="stat">
        Joined: {{ data.joined | relative_time }}
        </span>
        <span class="stat">
            Last seen: {{ data.connected | relative_time }}
        </span>
    </div>
    <div class="content-box">
        <div id="page-left" style="width: 460px;">
            {% if data.featured_submission %}
                <div class="text-title">Featured submission</div>
                <div class="profile-featured-submission">
                    <a href="/watch.php?v={{ data.featured_submission.id }}">
                        <img src="{{ thumbnail(data.featured_submission.id, data.featured_submission.type) }}"
                             alt="{{ data.featured_submission.title }}">
                    </a>
                    <div class="profile-featured-submission-title">
                        <a href="/watch.php?v={{ data.featured_submission.id }}">{{ data.featured_submission.title }}</a>
                    </div>
                </div>
            {% endif %}
        </div>
        <div id="page-right" style="width: 460px;">
            {% if data.journals %}
                <div class="text-title">Journals</div>
                {% for journal in data.journals %}
                    <div>
                        <div class="journal-entry">
                            <div class="journal-title">
                                <a href="read.php?j={{ journal.id }}">
                                    {{ journal.title|u.truncate(100, '...') }}
                                </a>
                            </div>
                            <div class="journal-contents">
                                {{ journal.contents|u.truncate(250, '...') }}
                            </div>
                        </div>
                    </div>
                {% endfor %}
            {% endif %}
        </div>
    </div>
    {% if data.submissions %}
        <div class="section">
            <div class="section-title">
                <h1>{{ data.username }}'s recent submissions</h1>
                <a href="browse.php">Browse</a>
            </div>
            <div class="content-box">
                {% for submission in data.submissions %}
                    {{ include('/components/_index_submission.twig') }}
                {% endfor %}
            </div>
        </div>
    {% endif %}
    <div class="section">
        <div class="section-title">
            <h1>Profile</h1>
        </div>
        <div class="content-box">
            {% if data.about %}
                {{ data.about }}
            {% else %}
                <em class="text-muted">This user has no description.</em>
            {% endif %}
        </div>
    </div>
    <div id="comments">
        <div class="content-header">
            <span>Comments</span>
        </div>
        <div class="content-box">
            {% if is_user_logged_in %}
                {{ include('/components/_comment_input.twig') }}
            {% endif %}
            <div id="comment"></div>
            {% for comment in data.comments %}
                {{ include('/components/_comment.twig') }}
                <div id="replies">
                    {% for comment in comment.replies %}
                        {{ include('/components/_comment.twig') }}
                    {% endfor %}
                </div>
            {% endfor %}
        </div>
    </div>
{% endblock %}